<div class="friend-detail-container" *ngIf="friend$ | async as friend">
    <div class="friend-header">
      <div class="back-button">
        <button mat-icon-button routerLink="/friends">
          <mat-icon>arrow_back</mat-icon>
        </button>
      </div>
      <div class="friend-title">
        <div class="friend-avatar" [style.backgroundImage]="'url(' + (friend.profilePic || '/assets/user-placeholder.jpg') + ')'"></div>
        <div class="friend-info">
          <h1>{{ friend.name }}</h1>
          <p>{{ friend.email }}</p>
        </div>
      </div>
      <div class="friend-actions">
        <button mat-icon-button [matMenuTriggerFor]="friendMenu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #friendMenu="matMenu">
          <button mat-menu-item>
            <mat-icon>edit</mat-icon>
            <span>Edit friend</span>
          </button>
          <button mat-menu-item>
            <mat-icon>delete</mat-icon>
            <span>Remove friend</span>
          </button>
        </mat-menu>
      </div>
    </div>
  
    <div class="friend-balance-summary">
      <div class="balance-card" [ngClass]="getBalanceClass(friend.balance)">
        <span class="balance-label">{{ friend.balance > 0 ? 'They owe you' : (friend.balance < 0 ? 'You owe' : 'All settled up') }}</span>
        <span class="balance-amount" *ngIf="friend.balance !== 0">₹{{ Math.abs(friend.balance) }}</span>
      </div>
      <button mat-raised-button color="primary" (click)="openSettleUpDialog(friend)" [disabled]="friend.balance === 0">
        <mat-icon>payments</mat-icon>
        Settle Up
      </button>
    </div>
  
    <div class="expenses-container">
      <h2>Expense History</h2>
      
      <div class="expenses-list">
        <ng-container *ngIf="(expenses$ | async)?.length; else noExpenses">
          <mat-card class="expense-card" *ngFor="let expense of expenses$ | async">
            <div class="expense-card-content">
              <div class="expense-date">
                {{ formatDate(expense.date) }}
              </div>
              <div class="expense-details">
                <div class="expense-description">{{ expense.description }}</div>
                <div class="expense-payer">
                  {{ expense.paidBy.name === 'John Doe' ? 'You' : expense.paidBy.name }} paid
                </div>
              </div>
              <div class="expense-amount">
                ₹{{ expense.amount }}
              </div>
            </div>
          </mat-card>
        </ng-container>
  
        <ng-template #noExpenses>
          <div class="empty-state">
            <mat-icon class="empty-icon">receipt_long</mat-icon>
            <h2>No expenses yet</h2>
            <p>Add an expense to start tracking</p>
            <button mat-raised-button color="primary" (click)="openAddExpenseDialog(friend)">
              <mat-icon>add</mat-icon>
              Add Expense
            </button>
          </div>
        </ng-template>
      </div>
    </div>
  
    <button 
      mat-fab 
      color="accent" 
      class="fab-button" 
      (click)="openAddExpenseDialog(friend)"
      aria-label="Add expense">
      <mat-icon>add</mat-icon>
    </button>
  </div>
  